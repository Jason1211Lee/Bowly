<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bowly｜保齡球戰績追蹤平台</title>
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <span class="navbar-brand mb-0 h1">🎳 Bowly</span>
      <div id="navAuth" style="display: none;">
        <small class="text-white me-3">用戶: <span id="userEmail">-</span></small>
        <button id="logoutBtn" class="btn btn-light btn-sm">登出</button>
      </div>
    </div>
  </nav>

  <!-- 認證視圖 -->
  <div id="authApp" class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-5">
        <div class="card">
          <div class="card-header bg-primary">
            <h4 class="mb-0 text-white">🎳 Bowly</h4>
          </div>
          <div class="card-body">
            <!-- 頁籤按鈕 -->
            <div class="btn-group w-100 mb-4" role="group">
              <button type="button" id="showLoginBtn" class="btn btn-primary active">登入</button>
              <button type="button" id="showRegisterBtn" class="btn btn-outline-primary">註冊</button>
            </div>
            
            <!-- 登入面板 -->
            <div id="loginPanel">
              <form id="loginForm">
                <div class="mb-3">
                  <label for="loginEmail" class="form-label">電子郵件</label>
                  <input type="email" class="form-control" id="loginEmail" required>
                </div>
                <div class="mb-3">
                  <label for="loginPassword" class="form-label">密碼</label>
                  <input type="password" class="form-control" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">登入</button>
              </form>
            </div>
            
            <!-- 註冊面板 -->
            <div id="registerPanel" style="display: none;">
              <form id="registerForm">
                <div class="mb-3">
                  <label for="registerEmail" class="form-label">電子郵件</label>
                  <input type="email" class="form-control" id="registerEmail" required>
                </div>
                <div class="mb-3">
                  <label for="registerPassword" class="form-label">密碼</label>
                  <input type="password" class="form-control" id="registerPassword" required>
                </div>
                <div class="mb-3">
                  <label for="confirmPassword" class="form-label">確認密碼</label>
                  <input type="password" class="form-control" id="confirmPassword" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">註冊</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 遊戲應用視圖 -->
  <div id="gameApp" style="display: none;">
    <div class="container-fluid mt-4">
    <div class="row">
      <!-- 左側：表單與管理區 -->
      <div class="col-lg-5 mb-4">
        <!-- 表單：輸入戰績 -->
        <div class="card">
          <div class="card-header bg-info">
            <h5 class="mb-0">新增戰績</h5>
          </div>
          <div class="card-body">
            <form id="gameForm">
              <div class="mb-3">
                <label for="gameDate" class="form-label">比賽日期 *</label>
                <input type="date" class="form-control" id="gameDate" required>
              </div>
              <div class="mb-3">
                <label class="form-label">總分 (0-300) 或 逐格輸入 *</label>
                <div class="input-group mb-2">
                  <input type="number" class="form-control" id="gameScore" min="0" max="300" placeholder="手動輸入總分" aria-label="總分">
                  <button type="button" class="btn btn-outline-secondary" id="openFramesBtn">逐格輸入</button>
                </div>

                <!-- 逐格輸入區（預設隱藏） -->
                <div id="framesInput" style="display:none;">
                  <small class="text-muted">輸入範例：0-9 / 表示補中，X 表示全倒（不分大小寫）。第10格可輸入 2~3 次。</small>
                  <div class="d-flex flex-wrap gap-2 mt-2" id="framesContainer">
                    <!-- 1-9 框 -->
                    <div class="frame" data-frame="1">
                      <label class="form-label">1</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="1" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="1" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="2">
                      <label class="form-label">2</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="2" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="2" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="3">
                      <label class="form-label">3</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="3" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="3" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="4">
                      <label class="form-label">4</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="4" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="4" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="5">
                      <label class="form-label">5</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="5" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="5" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="6">
                      <label class="form-label">6</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="6" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="6" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="7">
                      <label class="form-label">7</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="7" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="7" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="8">
                      <label class="form-label">8</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="8" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="8" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <div class="frame" data-frame="9">
                      <label class="form-label">9</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="9" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="9" data-roll="1" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                    <!-- 第10格可以三次輸入 -->
                    <div class="frame" data-frame="10">
                      <label class="form-label">10</label>
                      <div>
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="10" data-roll="0" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="10" data-roll="1" style="width:48px;display:inline-block;" />
                        <input maxlength="1" class="form-control form-control-sm frame-input" data-frame="10" data-roll="2" style="width:48px;display:inline-block;" />
                      </div>
                    </div>
                  </div>
                  <div class="mt-2">
                    <button type="button" class="btn btn-sm btn-primary" id="calcFramesBtn">計算並填入分數</button>
                    <button type="button" class="btn btn-sm btn-secondary" id="clearFramesBtn">清空格子</button>
                    <button type="button" class="btn btn-sm btn-link" id="closeFramesBtn">關閉</button>
                  </div>
                </div>

                <!-- 數字鍵盤（點擊按鍵輸入到被選中的格子） -->
                <div id="numericKeypad" class="mt-3" style="display:flex;flex-direction:column;gap:8px;">
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-dark keypad-key">1</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">2</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">3</button>
                    <button type="button" class="btn btn-outline-secondary keypad-key">X</button>
                  </div>
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-dark keypad-key">4</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">5</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">6</button>
                    <button type="button" class="btn btn-outline-secondary keypad-key">/</button>
                  </div>
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-dark keypad-key">7</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">8</button>
                    <button type="button" class="btn btn-outline-dark keypad-key">9</button>
                    <button type="button" class="btn btn-outline-danger keypad-action" id="keyDel">⌫</button>
                  </div>
                  <div class="d-flex gap-2">
                    <div style="flex:1"></div>
                    <button type="button" class="btn btn-outline-dark keypad-key">0</button>
                    <button type="button" class="btn btn-outline-success" id="keyNext">➡</button>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="gameStrikes" class="form-label">全倒數 (0-12)</label>
                  <input type="number" class="form-control" id="gameStrikes" min="0" max="12" value="0">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="gameSpares" class="form-label">補中數 (0-21)</label>
                  <input type="number" class="form-control" id="gameSpares" min="0" max="21" value="0">
                </div>
              </div>
              <button type="submit" class="btn btn-success w-100">新增紀錄</button>
            </form>
          </div>
        </div>

        <!-- 目標設定 -->
        <div class="card mt-3">
          <div class="card-header bg-warning">
            <h5 class="mb-0">目標設定</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="targetScore" class="form-label">目標平均分</label>
              <input type="number" class="form-control" id="targetScore" min="0" max="300" value="170">
            </div>
            <button type="button" class="btn btn-warning w-100" id="saveTargetBtn">保存目標</button>
          </div>
        </div>

        <!-- 管理功能 -->
        <div class="card mt-3">
          <div class="card-header bg-danger">
            <h5 class="mb-0">數據管理</h5>
          </div>
          <div class="card-body">
            <button type="button" class="btn btn-outline-success w-100 mb-2" id="exportBtn">📥 匯出 JSON</button>
            <button type="button" class="btn btn-outline-primary w-100 mb-2" id="importBtn">📤 匯入 JSON</button>
            <input type="file" id="importFile" accept=".json" style="display: none;">
            <button type="button" class="btn btn-outline-danger w-100" id="clearAllBtn">🗑️ 清空全部</button>
          </div>
        </div>
      </div>

      <!-- 右側：統計與圖表區 -->
      <div class="col-lg-7">
        <!-- 統計指標 -->
        <div class="row mb-4">
          <div class="col-md-6 mb-3">
            <div class="card text-center bg-light">
              <div class="card-body">
                <h6 class="card-title text-muted">平均分數</h6>
                <h3 id="avgScore" class="text-primary">--</h3>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card text-center bg-light">
              <div class="card-body">
                <h6 class="card-title text-muted">最高分</h6>
                <h3 id="maxScore" class="text-success">--</h3>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card text-center bg-light">
              <div class="card-body">
                <h6 class="card-title text-muted">總場次</h6>
                <h3 id="totalGames" class="text-info">0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card text-center bg-light">
              <div class="card-body">
                <h6 class="card-title text-muted">距離目標</h6>
                <h3 id="targetGap" class="text-warning">--</h3>
              </div>
            </div>
          </div>
        </div>

        <!-- 近 5 場成績 -->
        <div class="card mb-4">
          <div class="card-header bg-secondary">
            <h5 class="mb-0">近 5 場成績</h5>
          </div>
          <div class="card-body">
            <p id="recentScores" class="text-muted">暫無紀錄</p>
          </div>
        </div>

        <!-- 圖表區 -->
        <div class="card mb-4">
          <div class="card-header bg-secondary">
            <h5 class="mb-0">分數趨勢</h5>
          </div>
          <div class="card-body">
            <canvas id="trendChart"></canvas>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-header bg-secondary">
            <h5 class="mb-0">全倒/補中分佈</h5>
          </div>
          <div class="card-body">
            <canvas id="statsChart"></canvas>
          </div>
        </div>

        <!-- AI 建議區 -->
        <div class="card mb-4">
          <div class="card-header bg-info">
            <h5 class="mb-0">💡 AI 訓練建議</h5>
          </div>
          <div class="card-body">
            <p id="aiSuggestion" class="text-muted">累積 3 場以上成績後會有建議</p>
          </div>
        </div>

        <!-- 成績紀錄列表 -->
        <div class="card">
          <div class="card-header bg-secondary">
            <h5 class="mb-0">完整紀錄</h5>
          </div>
          <div class="card-body">
            <div id="recordsList" class="text-muted">暫無紀錄</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 結束 gameApp -->

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <!-- Firebase Config -->
  <script type="module" src="firebase-config.js"></script>
  <!-- Firebase Auth -->
  <script type="module" src="auth.js"></script>
  <!-- 應用邏輯 -->
  <script type="module" src="app.js"></script>
</body>
</html>
